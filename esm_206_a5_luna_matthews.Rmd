---
title: '{******Assignment 5 Working Title****}'
author: "Anthony Luna and Elliott Matthews"
date: "11/30/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(janitor)
library(broom)
library(kableExtra)
library(here)
library(ggridges)
library(ggbeeswarm)
library(scales)
library(effsize)

m_c_verts <- read_csv(here::here("data","mack_creek_vertebrates.csv")) %>% 
  clean_names() %>% 
  filter(species %in% c("DITE")) %>% 
  filter(unittype %in% c("P","C","SC"))%>% 
  mutate(section_full = case_when(section=="CC"~"Clear cut",T~"Old growth")) %>% 
  mutate(unittype_full = case_when(unittype == "P"~"Pool",
                                   unittype == "SC"~"Side channel",
                                   unittype == "C"~"Cascade"))

```


## Introduction

## Data and Methods

## Results

#### Pacific giant salamander population changes over time


```{r, fig.cap="**Figure 1**: Old growth and clear cut regional populations tend to vary similarly, however the clear cut population is generally lower than the old growth populations."}
giant_sal_counts <- m_c_verts %>% 
  count(year, section_full)

giant_sal_counts %>% 
  ggplot(aes(x = year, y = n)) +
  geom_line(aes( group = section_full, 
                 color = section_full),
            size = 1.05) +
  ggtitle("Old growth vs clear cut Pacific Giant Salamander populations ") +
  labs(subtitle = "Timeframe: 1993 to 2017") +
  xlab( "Year") +
  ylab("Salamander count") +
  scale_x_continuous(breaks = seq(1993,2017,by=4)) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = c(.15, .7))



  
  
  ##### need to fix title to fit, add caption, and description
```


#### Pacific giant salamander population distributions in 2017

```{r}
giant_sal_2017_counts <- m_c_verts %>% 
  filter(section %in% c("OG", "CC")) %>% 
  filter(unittype %in% c("P", "C", "SC")) %>% 
  filter(year == "2017") %>% 
  count(section_full, unittype)

giant_sal_2017_table <- giant_sal_2017_counts %>% 
  pivot_wider(names_from = unittype,
               values_from = n)
  
 giant_sal_2017_props <- giant_sal_2017_table %>%  
   adorn_percentages(denominator = "row") %>% 
   adorn_pct_formatting(digits = 1) %>% 
   adorn_ns(position = "front")
 
 kable(giant_sal_2017_props,
       caption = "Table 1: Salamander count by location found in channel (2017)",
       col.names = c( "Forest condition", 
                      "Cascades", 
                      "Pool", 
                      "Side channel")) %>% 
   kable_styling("striped", 
                 full_width = F)
 

#Fix CC and OG
```

***MOTIONING TO REMOVE THE 'RESULTS C' HEADER, AS THIS IS DIRECTLY RELATED TO TABLE 1***

```{r}
giant_sal_chi_counts <- giant_sal_2017_table %>% 
  select(-section_full)

##List H0 and Hother one

giant_sal_chi <- chisq.test(giant_sal_chi_counts)


```



Based off the p value retain null hypothesis that there is no significant association between forest condition and location in channel found.


#### Comparison of weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017.


```{r}
d_data <- m_c_verts %>% 
  filter(year==2017) %>%
  filter(weight != "NA") %>% 
  select(section,weight)
```


```{r}
cc_w <- d_data %>% filter(section == "CC") %>% select(weight)
og_w <- d_data %>% filter(section == "OG") %>% select(weight)


cc_mean <- round(mean(cc_w$weight), digits = 3)
og_mean <- round(mean(og_w$weight), digits = 3)

d_test_raw <- t.test(weight~section,d_data,paired = FALSE)

d_test <- broom::tidy(d_test_raw)

d_pctdiff <- scales::percent(abs(d_test$estimate1 - d_test$estimate2)/mean(c(d_test$estimate1,d_test$estimate2)))
```

Populations found in clear cut and old growth sections of the creek showed a statistically significant diffence in mean weights (p = `r round(d_test$p.value,digits=3)`, $\alpha$ = 0.05). The percent difference between the mean weights is `r d_pctdiff` (Clear cut mean = `r cc_mean` g, Old growth mean = `r og_mean` g).

#### Comparison of weights of Pacific giant salamanders in pools, cascades and side-channels of Mack Creek in 2017.

```{r}
e_data <- m_c_verts %>% 
  filter(year==2017) %>%
  filter(weight != "NA") %>% 
  select(unittype,weight)

e_mean <- e_data %>% 
  group_by(unittype) %>% 
  summarize(mean = mean(weight),
            sd = sd(weight))
```

```{r}
e_plot <- ggplot(data = e_data)+
  geom_violin(aes(x=unittype,y=weight))+
  geom_errorbar(data = e_mean, aes(x= unittype,ymax=mean+sd, ymin=mean-sd))+
  geom_point(data = e_mean, aes(x=unittype,y=mean))

e_plot
```

```{r}
e_anova_raw <- aov(weight~unittype, data = e_data)

e_anova <- broom::tidy(e_anova_raw)

c_p_cohen <- cohen.d(weight~unittype, data=e_data %>% filter(unittype != "SC"))
p_sc_cohen <- cohen.d(weight~unittype, data=e_data %>% filter(unittype != "C"))
c_sc_cohen <- cohen.d(weight~unittype, data=e_data %>% filter(unittype != "P"))
```

There is a statistically significant difference between the three channel classifications (p = `r round(e_anova$p.value[1], digits = 3)`). A pairwise comparison of the effective size (Cohen's d) was found to be negligible when comparing cascales and pools ($d=$ `r round(c_p_cohen$estimate,digits=3)`), and small when comparing side channels to pools ($d=$ `r round(p_sc_cohen$estimate,digits=3)`), and side channels to cascades ($d=$ `r round(c_sc_cohen$estimate,digits=3)`). Dispite this statistical difference, it is difficult to determine which channel classifications have differences without post-hoc testing. Further analysis using a pairwise comparison of channel classifications, such as Tukey's Honest Significant Difference, could be used to determine which groups have a statistically significant differences.

## Summary

## References









